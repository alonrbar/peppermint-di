!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("peppermint-di",[],t):"object"==typeof exports?exports["peppermint-di"]=t():e["peppermint-di"]=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var o=n(6);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(7);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NestedError=void 0;class r extends Error{static createStack(e,t){return t?(e+="\n------------------------------------------------\n",e+="Inner Error: ",t instanceof Error?e+=t.stack:e+=t.toString(),e):e}constructor(e,t){super(e),this.stack=r.createStack(this.stack,t),Object.setPrototypeOf(this,r.prototype)}}t.NestedError=r},function(e,t){e.exports=require("reflect-metadata")},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ResolveOptions=void 0;t.ResolveOptions=class{constructor(){r(this,"optionalParameters",!1),r(this,"constructUnregistered",!0),r(this,"params",void 0)}}},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var o=n(8);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=n(9);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s=n(10);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=n(3);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var a=n(11);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolveError=void 0;var r=n(1);class o extends r.NestedError{constructor(e,t){super(`Failed to resolve '${e}'.`,t),Object.setPrototypeOf(this,o.prototype)}}t.ResolveError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeInferenceError=void 0;class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}}t.TypeInferenceError=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0,n(2);var r=n(0),o=n(3);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){}class c{static get canReflect(){if(void 0===c._canReflect)try{c._canReflect=!(!Reflect||!Reflect.construct)}catch(e){c._canReflect=!1}return c._canReflect}constructor(e){i(this,"logger",void 0),i(this,"factories",new Map),i(this,"initializers",new Map),i(this,"potentialSingletons",new Map),i(this,"singletons",new Map),this.logger=e||s}register(e,t){this.validateKey(e);const n=this.getKeyString(e);if(null!==t&&void 0!==t||"function"!=typeof e){if(!t)throw new Error("Missing argument 'type'.");if("function"!=typeof t)throw new Error("Invalid argument 'type'. Constructor function expected.");this.logger(`Registering '${n}' (type as constructor)`),this.factories.set(e,()=>this.resolveCTor(t,null))}else this.logger(`Registering '${n}' (key as constructor)`),this.factories.set(e,()=>this.resolveCTor(e,null))}registerFactory(e,t){if(this.validateKey(e),"function"!=typeof t)throw new Error("Invalid argument 'factory'. Factory function expected.");const n=this.getKeyString(e);this.logger(`Registering '${n}' (factory callback)`),this.factories.set(e,t)}registerSingle(e,t){this.validateKey(e);const n=this.getKeyString(e);if(null!==t&&void 0!==t||"function"!=typeof e)if("object"==typeof t)this.logger(`Registering '${n}' as singleton (value as instance)`),this.singletons.set(e,t);else{if("function"!=typeof t)throw new Error("Invalid argument 'value'. Expected object or function.");this.logger(`Registering '${n}' as singleton (value as constructor)`),this.potentialSingletons.set(e,()=>this.resolveCTor(t,null))}else this.logger(`Registering '${n}' as singleton (key as constructor)`),this.potentialSingletons.set(e,()=>this.resolveCTor(e,null))}registerSingleFactory(e,t){if(this.validateKey(e),"function"!=typeof t)throw new Error("Invalid argument 'factory'. Factory function expected.");const n=this.getKeyString(e);this.logger(`Registering '${n}' as singleton (factory callback)`),this.potentialSingletons.set(e,t)}registerInitializer(e,t){if(this.validateKey(e),"function"!=typeof t)throw new Error("Invalid argument 'initializer'. Initializer function expected.");const n=this.getKeyString(e);this.logger(`Registering an initializer for '${n}'`);let r=this.initializers.get(e);r||(r=[],this.initializers.set(e,r)),r.push(t)}get(e,t){return this.validateKey(e),this.resolveSingleDependency(e,t)}call(e,t,n){const r=this.resolveDependencies(e,n);return e.apply(t,r)}validateKey(e){if("string"!=typeof e&&"function"!=typeof e&&"symbol"!=typeof e)throw new Error(`Invalid argument 'key'. Expected string, symbol or function. Received: ${JSON.stringify(e)}.`)}getKeyString(e){return"string"==typeof e?e:"function"==typeof e?e.name:e.toString()}resolveSingleDependency(e,t){const n=this.getKeyString(e);if((t=Object.assign(new o.ResolveOptions,t||{})).params){const r=t.params.get(e);if(void 0!==r)return this.logger(`Resolving '${n}' from params`),r}const i=this.factories.get(e);if(void 0!==i){this.logger(`Resolving '${n}' from internal registry`);const t=this.resolveFactory(e,i);return this.initializeInstance(e,t),t}const s=this.singletons.get(e);if(void 0!==s)return this.logger(`Resolving '${n}' from internal registry (singleton)`),s;const c=this.potentialSingletons.get(e);if(void 0!==c)return this.logger(`Resolving '${n}' from internal registry (singleton factory)`),this.resolveSingletonFactory(e,c);if(t.constructUnregistered&&"function"==typeof e){this.logger(`Resolving '${n}' by invoking as constructor`);const r=this.resolveCTor(e,t);return this.initializeInstance(e,r),r}if(!t.optionalParameters)throw new r.ResolveError(n,new Error("Dependency is not registered."));this.logger(`Resolving '${n}' as optional parameter (undefined)`)}resolveFactory(e,t){try{return t()}catch(t){const n=this.getKeyString(e);throw new r.ResolveError(n,t)}}resolveSingletonFactory(e,t){const n=this.getKeyString(e);let o;try{o=t()}catch(e){throw new r.ResolveError(n,e)}this.initializeInstance(e,o);try{this.singletons.set(e,o)}catch(e){throw new r.ResolveError(n,e)}return this.potentialSingletons.delete(e),o}resolveCTor(e,t){const n=this.resolveDependencies(e,t);if(c.canReflect)return Reflect.construct(e,n);{const t=function(){e.apply(this,n)};return t.prototype=e.prototype,new t}}initializeInstance(e,t){const n=this.initializers.get(e);if(n)for(const e of n)e(t)}resolveDependencies(e,t){if("function"!=typeof e)throw new Error("Invalid argument 'func'. Expected function.");const n=this.getArgumentKeys(e),o=[];for(const i of n){let n;try{n=this.resolveSingleDependency(i,t)}catch(t){throw new r.ResolveError(e.name||"<anonymous>",t)}o.push(n)}return o}getArgumentKeys(e){const t=this.getArgumentNames(e),n=this.getArgumentTypes(e);if(!n||!n.length)return t;if(t.length!==n.length)throw new Error("Failed reflecting function arguments.");const o=n.map((n,o)=>{if(!n)throw new r.TypeInferenceError(`Can not infer type of argument in index ${o} of the function '${e.name}'.`);return"Object"!==n.name&&"String"!==n.name?n:t[o]}),i=o.map(e=>"function"==typeof e?e.name:e);return this.logger(`Arguments of '${e.name}': ${JSON.stringify(i)}`),o}getArgumentNames(e){const t=e.toString().match(/^function\s*?[^\(]*?\(\s*?([^\)]*?)\)/m),n=e.toString().match(/^class[\s\S]*?constructor\s*?[^\(]*?\(\s*?([^\)]*?)\)/m);let r;if(n&&n.length)this.logger(`Function '${e.name}' declared as es5 class`),r=n[1];else{if(!t||!t.length)return this.logger(`Could not detect arguments of '${e.name}'`),[];this.logger(`Function '${e.name}' declared as standard function`),r=t[1]}return r=r.split(",").map(e=>e.trim()).filter(e=>""!==e)}getArgumentTypes(e){return c.canReflect?Reflect.getMetadata("design:paramtypes",e):[]}}t.Container=c,i(c,"_canReflect",void 0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.i=function(e){return(t,n,r)=>{const o=Reflect.getMetadata("design:paramtypes",t);o[r]=e,Reflect.defineMetadata("design:paramtypes",o,t)}},n(2)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=function(e){}},function(e,t,n){"use strict"}])});