!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("peppermint-di",[],e):"object"==typeof exports?exports["peppermint-di"]=e():t["peppermint-di"]=e()}(this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e){t.exports=require("reflect-metadata")},function(t,e,n){"use strict";n.r(e);var r,o=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=function(t){function e(n,r){var o=t.call(this,n)||this;return o.stack=e.createStack(o.stack,r),Object.setPrototypeOf(o,e.prototype),o}return o(e,t),e.createStack=function(t,e){return e?(t+="\n------------------------------------------------\n",t+="Inner Error: ",e instanceof Error?t+=e.stack:t+=e.toString(),t):t},e}(Error),s=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),c=function(t){function e(n,r){var o=t.call(this,"Failed to resolve '"+n+"'.",r)||this;return Object.setPrototypeOf(o,e.prototype),o}return s(e,t),e}(i),a=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return a(e,t),e}(Error),f=(n(0),function(){return function(){this.optionalParameters=!1,this.constructUnregistered=!0,this.params={}}}()),l=n(2);function p(t){}var g=function(){function t(t){this.factories=new Map,this.initializers=new Map,this.potentialSingletons=new Map,this.singletons=new Map,this.logger=t||p}return Object.defineProperty(t,"canReflect",{get:function(){if(void 0===t._canReflect)try{t._canReflect=!(!Reflect||!Reflect.construct)}catch(e){t._canReflect=!1}return t._canReflect},enumerable:!0,configurable:!0}),t.prototype.register=function(t,e){var n=this;this.validateKey(t);var r=this.getKeyString(t);if(null!==e&&void 0!==e||"function"!=typeof t){if(!e)throw new Error("Missing argument 'type'.");if("function"!=typeof e)throw new Error("Invalid argument 'type'. Constructor function expected.");this.logger("Registering '"+r+"' (type as constructor)"),this.factories.set(t,function(){return n.resolveCTor(e,null)})}else this.logger("Registering '"+r+"' (key as constructor)"),this.factories.set(t,function(){return n.resolveCTor(t,null)})},t.prototype.registerFactory=function(t,e){if(this.validateKey(t),"function"!=typeof e)throw new Error("Invalid argument 'factory'. Factory function expected.");var n=this.getKeyString(t);this.logger("Registering '"+n+"' (factory callback)"),this.factories.set(t,e)},t.prototype.registerSingle=function(t,e){var n=this;this.validateKey(t);var r=this.getKeyString(t);if(null!==e&&void 0!==e||"function"!=typeof t)if("object"==typeof e)this.logger("Registering '"+r+"' as singleton (value as instance)"),this.singletons.set(t,e);else{if("function"!=typeof e)throw new Error("Invalid argument 'value'. Expected object or function.");this.logger("Registering '"+r+"' as singleton (value as constructor)"),this.potentialSingletons.set(t,function(){return n.resolveCTor(e,null)})}else this.logger("Registering '"+r+"' as singleton (key as constructor)"),this.potentialSingletons.set(t,function(){return n.resolveCTor(t,null)})},t.prototype.registerSingleFactory=function(t,e){if(this.validateKey(t),"function"!=typeof e)throw new Error("Invalid argument 'factory'. Factory function expected.");var n=this.getKeyString(t);this.logger("Registering '"+n+"' as singleton (factory callback)"),this.potentialSingletons.set(t,e)},t.prototype.registerInitializer=function(t,e){if(this.validateKey(t),"function"!=typeof e)throw new Error("Invalid argument 'initializer'. Initializer function expected.");var n=this.getKeyString(t);this.logger("Registering an initializer for '"+n+"'");var r=this.initializers.get(t);r||(r=[],this.initializers.set(t,r)),r.push(e)},t.prototype.get=function(t,e){return this.validateKey(t),this.resolveSingleDependency(t,e)},t.prototype.call=function(t,e,n){var r=this.resolveDependencies(t,n);return t.apply(e,r)},t.prototype.validateKey=function(t){if("string"!=typeof t&&"function"!=typeof t&&"symbol"!=typeof t)throw new Error("Invalid argument 'key'. Expected string, symbol or function. Received: "+JSON.stringify(t)+".")},t.prototype.getKeyString=function(t){return"string"==typeof t?t:"function"==typeof t?t.name:t.toString()},t.prototype.resolveSingleDependency=function(t,e){var n=this.getKeyString(t),r=(e=l(e,new f)).params[n];if(void 0!==r)return this.logger("Resolving '"+n+"' from params"),r;var o=this.factories.get(t);if(void 0!==o){this.logger("Resolving '"+n+"' from internal registry");var i=this.resolveFactory(t,o);return this.initializeInstance(t,i),i}var s=this.singletons.get(t);if(void 0!==s)return this.logger("Resolving '"+n+"' from internal registry (singleton)"),s;var a=this.potentialSingletons.get(t);if(void 0!==a)return this.logger("Resolving '"+n+"' from internal registry (singleton factory)"),this.resolveSingletonFactory(t,a);if(e.constructUnregistered&&"function"==typeof t){this.logger("Resolving '"+n+"' by invoking as constructor");i=this.resolveCTor(t,e);return this.initializeInstance(t,i),i}if(!e.optionalParameters)throw new c(n,new Error("Dependency is not registered."));this.logger("Resolving '"+n+"' as optional parameter (undefined)")},t.prototype.resolveFactory=function(t,e){try{return e()}catch(e){var n=this.getKeyString(t);throw new c(n,e)}},t.prototype.resolveSingletonFactory=function(t,e){var n,r=this.getKeyString(t);try{n=e()}catch(t){throw new c(r,t)}this.initializeInstance(t,n);try{this.singletons.set(t,n)}catch(t){throw new c(r,t)}return this.potentialSingletons.delete(t),n},t.prototype.resolveCTor=function(e,n){var r=this.resolveDependencies(e,n);if(t.canReflect)return Reflect.construct(e,r);var o=function(){e.apply(this,r)};return o.prototype=e.prototype,new o},t.prototype.initializeInstance=function(t,e){var n=this.initializers.get(t);if(n)for(var r=0,o=n;r<o.length;r++){(0,o[r])(e)}},t.prototype.resolveDependencies=function(t,e){if("function"!=typeof t)throw new Error("Invalid argument 'func'. Expected function.");for(var n=[],r=0,o=this.getArgumentKeys(t);r<o.length;r++){var i=o[r],s=void 0;try{s=this.resolveSingleDependency(i,e)}catch(e){throw new c(t.name||"<anonymous>",e)}n.push(s)}return n},t.prototype.getArgumentKeys=function(t){var e=this.getArgumentNames(t),n=this.getArgumentTypes(t);if(!n||!n.length)return e;if(e.length!==n.length)throw new Error("Failed reflecting function arguments.");var r=n.map(function(n,r){if(!n)throw new u("Can not infer type of argument in index "+r+" of the function '"+t.name+"'.");return"Object"!==n.name&&"String"!==n.name?n:e[r]}),o=r.map(function(t){return"function"==typeof t?t.name:t});return this.logger("Arguments of '"+t.name+"': "+JSON.stringify(o)),r},t.prototype.getArgumentNames=function(t){var e,n=t.toString().match(/^function\s*?[^\(]*?\(\s*?([^\)]*?)\)/m),r=t.toString().match(/^class[\s\S]*?constructor\s*?[^\(]*?\(\s*?([^\)]*?)\)/m);if(r&&r.length)this.logger("Function '"+t.name+"' declared as es5 class"),e=r[1];else{if(!n||!n.length)return this.logger("Could not detect arguments of '"+t.name+"'"),[];this.logger("Function '"+t.name+"' declared as standard function"),e=n[1]}return e=e.split(",").map(function(t){return t.trim()}).filter(function(t){return""!==t})},t.prototype.getArgumentTypes=function(e){return t.canReflect?Reflect.getMetadata("design:paramtypes",e):[]},t}();function y(t){return function(e,n,r){var o=Reflect.getMetadata("design:paramtypes",e);o[r]=t,Reflect.defineMetadata("design:paramtypes",o,e)}}function h(t){}n.d(e,"NestedError",function(){return i}),n.d(e,"ResolveError",function(){return c}),n.d(e,"TypeInferenceError",function(){return u}),n.d(e,"Container",function(){return g}),n.d(e,"i",function(){return y}),n.d(e,"injectable",function(){return h}),n.d(e,"ResolveOptions",function(){return f})},function(t,e){t.exports=require("lodash.defaultsdeep")},function(t,e,n){t.exports=n(1)}])});